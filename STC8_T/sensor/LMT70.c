#include "LMT70.H"
#include "STC8F.H"

float code LUT[206]=//从-55~150摄氏度
{
    1375.219,1370.215,1365.283,1360.342,1355.395,1350.441,
	1345.159,1340.229,1335.293,1330.352,1325.405,1320.453,1315.496,1310.534,1305.566,1300.593,
	1295.147,1290.202,1285.25,1280.291,1275.326,1270.353,1265.375,1260.389,1255.397,1250.398,
	1244.953,1239.97,1234.981,1229.986,1224.984,1219.977,1214.963,1209.943,1204.916,1199.884,
	1194.425,1189.41,1184.388,1179.361,1174.327,1169.288,1164.242,1159.191,1154.134,1149.07,
	1143.654,1138.599,1133.54,1128.476,1123.407,1118.333,1113.254,1108.17,1103.081,1097.987,
	1092.532,1087.453,1082.37,1077.282,1072.189,1067.09,1061.987,1056.879,1051.765,1046.647,
	1041.166,1036.062,1030.952,1025.838,1020.72,1015.596,1010.467,1005.333,1000.194,995.05,
	989.583,984.45,979.313,974.171,969.025,963.875,958.72,953.56,948.396,943.227,
	937.729,932.576,927.418,922.255,917.087,911.915,906.738,901.556,896.37,891.178,
	885.645,880.468,875.287,870.1,864.909,859.713,854.513,849.307,844.097,838.882,
	833.343,828.141,822.934,817.723,812.507,807.287,802.062,796.832,791.598,786.36,
	780.807,775.58,770.348,765.113,759.873,754.628,749.38,744.127,738.87,733.608,
	728.055,722.804,717.55,712.292,707.029,701.762,696.491,691.217,685.937,680.654,
	675.073,669.803,664.528,659.25,653.967,648.68,643.389,638.094,632.794,627.49,
	621.896,616.603,611.306,606.006,600.701,595.392,590.079,584.762,579.442,574.117,
	568.504,563.192,557.877,552.557,547.233,541.905,536.573,531.236,525.895,520.551,
	514.886,509.557,504.223,498.885,493.542,488.195,482.843,477.486,472.125,466.76,
	460.936,455.612,450.28,444.941,439.593,434.238,428.875,423.504,418.125,412.739,
	406.483,401.169,395.841,390.499,385.144,379.775,374.393,368.997,363.587,358.164,
	351.937,346.508,341.071,335.625,330.172,324.711,319.241,313.764,308.279,302.785
};

int QueryLut(float t,int right,int left)
{
	int mid = (right + left)/2;
	while (left < right)
	{
		if(t>LUT[mid]) right = mid;
		else left = mid;
		if(LUT[mid] > t && LUT[mid+1] <= t) return mid + 1;
		mid = (right+left)/2;
	}
	return 0;
}

float QueryTemp(float AdcVoltage){
    float temp;
    //下限
    if(AdcVoltage > 1375.219) temp=-56;
    else
    {
        //上限
        if(AdcVoltage < 302.785) temp = 151;
        else
        {
        	int i = QueryLut(AdcVoltage,205,0);
            //中间温度
            temp = (float)(i - 55)- (AdcVoltage - LUT[i]) / (LUT[i-1] - LUT[i]);
        }
    }
    return temp;
}